# ADR-0002: SVG over Canvasの採用

## ステータス

承認済み

## コンテキスト

Phyllotaxis Plannerでは、アイデアノードを視覚的に配置・表示するための描画技術の選択が必要でした。以下の要件を考慮する必要がありました：

- フィロタキシス配置による複数のアイデアノードの描画
- スムーズなアニメーション効果
- レスポンシブデザインへの対応
- アクセシビリティの確保
- React コンポーネントとの統合
- CSS スタイリングとの連携
- パフォーマンスの最適化

## 決定

描画技術としてSVG（Scalable Vector Graphics）を採用し、HTML5 Canvasは使用しないことを決定しました。

## 理由

### SVG採用の理由

1. **DOM統合**: SVG要素はDOMの一部として扱われ、React コンポーネントと自然に統合
2. **CSS統合**: Tailwind CSSやCSS-in-JSとの完全な互換性
3. **アクセシビリティ**: スクリーンリーダーやキーボードナビゲーションに対応
4. **スケーラビリティ**: ベクター形式により、あらゆる解像度で鮮明な表示
5. **イベントハンドリング**: 個別の要素に対するクリック、ホバーイベントが容易
6. **デバッグ性**: ブラウザの開発者ツールで要素の検査が可能
7. **宣言的記述**: JSXによる直感的な記述が可能

### Canvas不採用の理由

1. **DOM分離**: Canvas内の要素はDOMから分離されており、React の状態管理と相性が悪い
2. **アクセシビリティ**: Canvas内容はスクリーンリーダーからアクセスできない
3. **CSS制限**: Canvas内要素にCSSスタイルを直接適用できない
4. **イベント処理**: 個別要素のイベント処理が複雑
5. **レスポンシブ対応**: 画面サイズ変更時の再描画処理が必要

## 代替案

### HTML5 Canvas
**利点:**
- 高性能な描画処理
- 複雑なグラフィック処理に適している
- ピクセルレベルの制御が可能

**欠点:**
- DOM統合の困難さ
- アクセシビリティの問題
- React との統合の複雑さ
- CSS スタイリングの制限

### WebGL
**利点:**
- 3D描画とハードウェアアクセラレーション
- 大量のオブジェクトの高速描画

**欠点:**
- 学習コストが高い
- 2Dアプリケーションには過剰
- ブラウザ互換性の問題
- アクセシビリティの困難さ

### CSS + HTML
**利点:**
- 最もシンプルな実装
- 完全なアクセシビリティ対応

**欠点:**
- 複雑な配置計算の困難さ
- アニメーション性能の制限
- 大量要素での性能問題

## 影響

### 正の影響

1. **開発効率**: React コンポーネントとしての自然な実装
2. **保守性**: 宣言的なコードによる理解しやすさ
3. **アクセシビリティ**: WCAG準拠のアクセシブルなアプリケーション
4. **スタイリング**: Tailwind CSSとの完全な統合
5. **デバッグ**: ブラウザツールでの要素検査が可能
6. **SEO**: SVG内容が検索エンジンにインデックスされる

### 負の影響

1. **パフォーマンス制限**: 大量のSVG要素（1000+）でのパフォーマンス低下の可能性
2. **メモリ使用量**: DOM要素として各ノードがメモリを消費
3. **複雑なアニメーション**: Canvas比較での制限

### 技術的制約

1. **要素数制限**: MVPでは50個のアイデア上限を設定
2. **アニメーション最適化**: CSS transitionsとtransformを活用
3. **仮想化**: 将来的に大量データ対応が必要な場合は仮想化を検討

### パフォーマンス対策

```typescript
// パフォーマンス最適化の例
const IdeaNode = React.memo(({ idea, isAnimating }: IdeaNodeProps) => {
  return (
    <g transform={`translate(${idea.position.x}, ${idea.position.y})`}>
      <circle
        r="20"
        className={`transition-all duration-500 ${
          isAnimating ? 'animate-pulse' : ''
        }`}
      />
      <text className="text-sm font-medium">{idea.text}</text>
    </g>
  );
});
```

## 関連文書

- [SVG 仕様書](https://www.w3.org/TR/SVG2/)
- [React と SVG の統合](https://reactjs.org/docs/dom-elements.html#svg-elements)
- [設計書: 描画戦略](../design.md#svg描画戦略)
- [Web Accessibility Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)